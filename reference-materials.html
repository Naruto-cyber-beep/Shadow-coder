<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puter Pro - Ultra AI</title>
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
        }
        .ai-bubble {
            background: linear-gradient(135deg, #f3f4f6 0%, #ffffff 100%);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .user-bubble {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        @keyframes pop {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .msg-animate { animation: pop 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body class="bg-[#f0f2f5] min-h-screen flex items-center justify-center p-4">

    <div class="fixed top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-200 rounded-full blur-[120px] opacity-50"></div>
    <div class="fixed bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-purple-200 rounded-full blur-[120px] opacity-50"></div>

    <div class="glass-panel w-full max-w-4xl h-[85vh] rounded-[2.5rem] flex flex-col overflow-hidden relative z-10">
        
        <header class="p-6 border-b border-gray-200/50 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="relative">
                    <div class="w-12 h-12 bg-indigo-600 rounded-2xl rotate-3 flex items-center justify-center shadow-indigo-200 shadow-lg">
                        <span class="text-white font-black text-2xl -rotate-3">P</span>
                    </div>
                    <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-4 border-white rounded-full"></div>
                </div>
                <div>
                    <h1 class="text-xl font-800 text-gray-800 tracking-tight">Puter Pro AI</h1>
                    <p class="text-[10px] font-bold text-indigo-500 uppercase tracking-widest">Claude 3.5 Sonnet Engine</p>
                </div>
            </div>
            <button onclick="clearHistory()" class="px-4 py-2 text-xs font-semibold text-gray-500 hover:bg-red-50 hover:text-red-600 rounded-full transition-all">
                Reset History
            </button>
        </header>

        <div id="chat-box" class="flex-1 overflow-y-auto p-8 space-y-6 scroll-smooth">
            </div>

        <footer class="p-6 bg-white/40 border-t border-gray-200/50">
            <div class="relative flex items-center">
                <input id="user-input" type="text" 
                    placeholder="Message Puter Pro..." 
                    class="w-full pl-6 pr-16 py-4 bg-white/80 border border-gray-200 rounded-2xl outline-none focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 transition-all shadow-inner"
                    onkeypress="if(event.key === 'Enter') sendMessage()">
                
                <button onclick="sendMessage()" id="send-btn" 
                    class="absolute right-2 p-2.5 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 hover:shadow-lg hover:shadow-indigo-200 active:scale-90 transition-all font-bold">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                </button>
            </div>
            <p class="text-center text-[10px] text-gray-400 mt-3 font-medium">Cloud Memory Active • AI might generate inaccuracies</p>
        </footer>
    </div>

    <script>
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        let chatHistory = [];

        // 1. Initialize Cloud Memory on Load
        window.onload = async () => {
            try {
                const savedHistory = await puter.kv.get('chat_history_pro');
                if (savedHistory) {
                    chatHistory = JSON.parse(savedHistory);
                    chatHistory.forEach(msg => renderMessage(msg.role, msg.content));
                } else {
                    appendAndSave('ai', "Welcome to the Pro interface. How can I assist you today?");
                }
            } catch (e) { console.log("Memory clear"); }
        };

        function renderMessage(role, text) {
            const wrapper = document.createElement('div');
            wrapper.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} msg-animate`;
            
            const msg = document.createElement('div');
            msg.className = role === 'user' 
                ? 'user-bubble text-white px-6 py-4 rounded-[2rem] rounded-tr-none max-w-[85%] text-sm' 
                : 'ai-bubble text-gray-700 px-6 py-4 rounded-[2rem] rounded-tl-none max-w-[85%] text-sm leading-relaxed';
            
            msg.innerText = text;
            wrapper.appendChild(msg);
            chatBox.appendChild(wrapper);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function appendAndSave(role, content) {
            renderMessage(role, content);
            chatHistory.push({ role, content });
            // Save to Puter Cloud Database
            await puter.kv.set('chat_history_pro', JSON.stringify(chatHistory));
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            userInput.value = '';
            await appendAndSave('user', text);
            
            sendBtn.disabled = true;
            sendBtn.innerHTML = `<div class="w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"></div>`;

            try {
                // Using Claude-3.5-Sonnet via Puter.js
                const response = await puter.ai.chat(text, { 
                    model: 'claude-3-5-sonnet',
                    history: chatHistory // Sends history for context awareness
                });

                const aiResponse = response.text || response.message.content;
                await appendAndSave('ai', aiResponse);

            } catch (error) {
                renderMessage('ai', "⚠️ Error: " + error.message);
                if(error.message.includes('auth')) await puter.auth.signIn();
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>`;
            }
        }

        async function clearHistory() {
            if(confirm("Wipe cloud memory?")) {
                chatHistory = [];
                await puter.kv.del('chat_history_pro');
                chatBox.innerHTML = '';
                appendAndSave('ai', "Memory wiped. Ready for a new session.");
            }
        }
    </script>
</body>
  </html>
