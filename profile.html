<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shadow Circle â€“ Live Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-tr from-fuchsia-100 to-blue-100 min-h-screen flex items-center justify-center">

<div class="w-full max-w-lg p-8 bg-white shadow-xl rounded-3xl mx-auto space-y-7 text-center">

  <h2 class="text-2xl font-bold text-violet-700 mb-6">Profile</h2>

  <div id="auth-section">
    <button id="google-btn"
      class="py-2 px-6 bg-red-600 hover:bg-red-700 text-white text-lg rounded-lg font-semibold shadow transition mb-2">
      <svg class="inline mr-2 -mt-1" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 48 48"><g><path fill="#FFC107" d="M43.61 20.083h-18.5v7.834h10.638c-1.19 3.648-4.56 6.25-8.638 6.25-5.273 0-9.555-4.28-9.555-9.555s4.28-9.555 9.555-9.555c2.63 0 5.004 1.015 6.716 2.615l5.736-5.736c-3.222-2.988-7.465-4.829-12.452-4.829C13.52 7 5.445 15.077 5.445 24.357s8.074 17.36 17.36 17.36c8.313 0 16.004-6.02 16.004-16.005a21.013 21.013 0 0 0-.203-3.629z"/></g></svg>
      Connect with Google
    </button>
  </div>

  <!-- Registered user info -->
  <div id="profile-section" class="hidden mt-3 text-left">
    <div class="flex flex-col items-center mb-4">
      <img id="user-photo" class="rounded-full w-24 h-24 bg-gray-200 border-4 border-violet-200 object-cover" src="" alt="Photo" />
      <div class="mt-2 text-xl font-semibold text-violet-700" id="user-name"></div>
      <div class="text-gray-600 text-lg" id="user-email"></div>
      <span id="special-badge"></span>
    </div>
    <div class="p-4 bg-violet-50 rounded-xl mb-3 space-y-2">
      <div><b>UID:</b> <span id="uid"></span></div>
      <div><b>Token:</b> <span id="token"></span></div>
      <div><b>Batch:</b> <span id="specialGroup"></span></div>
      <div><b>Shadow Coins:</b> <span id="coins"></span></div>
      <div><b>Rank:</b> <span id="rank"></span></div>
      <div><b>Storage:</b> <span id="storage"></span></div>
    </div>
    <a href="leaderboard.html" class="inline-block mt-3 px-5 py-2 bg-violet-700 text-white rounded-lg font-semibold hover:bg-violet-800">Show Leaderboard</a>
  </div>

  <!-- Unregistered user -->
  <div id="no-user-section" class="hidden mt-4 text-gray-700">
    <div class="text-xl mb-1 font-semibold" id="google-name"></div>
    <div id="google-email" class="mb-2"></div>
    <img id="google-photo" class="w-20 h-20 rounded-full mx-auto mb-2" src="" alt="Google Photo" />
    <div class="mb-2 text-lg text-gray-500">You have not yet registered on Shadow Circle.</div>
    <div>
      <b>Batch:</b> Basic<br>
      <b>Shadow Coins:</b> 0<br>
      <b>Rank:</b> <i>Not started</i><br>
      <b>Storage:</b> 2GB
    </div>
    <a href="leaderboard.html" class="inline-block mt-3 px-5 py-2 bg-violet-700 text-white rounded-lg font-semibold hover:bg-violet-800">Show Leaderboard</a>
  </div>

  <div id="loading-msg" class="hidden text-violet-700 font-semibold mt-3"></div>
</div>

<!-- Firebase scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAOHLoX1OGHiznYvYeUSkrR2lAxzhVrsGw",
    authDomain: "learn-code-with-anay.firebaseapp.com",
    projectId: "learn-code-with-anay",
    storageBucket: "learn-code-with-anay.firebasestorage.app",
    messagingSenderId: "197075143711",
    appId: "1:197075143711:web:64fc5d83528f907d38d92a",
    measurementId: "G-F01VRZK4ZL"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  const googleBtn = document.getElementById('google-btn');
  const profileSection = document.getElementById('profile-section');
  const noUserSection = document.getElementById('no-user-section');
  const loadingMsg = document.getElementById('loading-msg');

  let unsubscribe = null; // for cleaning up the real-time listener

  googleBtn.onclick = async () => {
    loadingMsg.textContent = "Authenticating...";
    loadingMsg.classList.remove('hidden');
    try {
      const provider = new firebase.auth.GoogleAuthProvider();
      const result = await auth.signInWithPopup(provider);
      const user = result.user;
      if (!user || !user.email) {
        loadingMsg.textContent = "";
        alert("Could not get Google account. Try again.");
        return;
      }
      loadingMsg.textContent = "Listening for your user record...";
      // Realtime: listen for THIS user's doc in Firestore
      if (unsubscribe) unsubscribe(); // Remove previous listener if any
      unsubscribe = db.collection("users")
        .where("email", "==", user.email)
        .onSnapshot((snap) => {
          loadingMsg.textContent = ""; 
          if (!snap.empty) {
            const data = snap.docs[0].data();
            // "Unlimited" logic
            let isChosenOne = (
              (data.customUID === "shadow-anayupadhyay4138" && data.token === "971195") ||
              data.specialGroup === "first10"
            );
            profileSection.classList.remove('hidden');
            document.getElementById('auth-section').classList.add('hidden');
            noUserSection.classList.add('hidden');
            document.getElementById('user-photo').src = data.photoURL || user.photoURL || "";
            document.getElementById('user-name').textContent = data.name || user.displayName || "";
            document.getElementById('user-email').textContent = data.email || user.email;
            document.getElementById('uid').textContent = data.customUID || "-";
            document.getElementById('token').textContent = data.token || "-";
            document.getElementById('coins').textContent = isChosenOne ? "âˆž" : (typeof data.coins === "number" ? data.coins : 0);
            document.getElementById('rank').textContent = isChosenOne ? "1 (Maha Yodha)" : (data.rank !== undefined ? data.rank : "-");
            document.getElementById('specialGroup').textContent = isChosenOne ? "Unlimited (Maha Yodha)" : (data.specialGroup === "first10" ? "Maha Yodha" : (data.specialGroup || "Basic"));
            document.getElementById('storage').textContent = isChosenOne ? "Unlimited" : (data.storagePlan || "2GB");
            document.getElementById('special-badge').innerHTML = isChosenOne
              ? `<span class="inline-block rounded-full px-4 py-1 bg-yellow-300 text-orange-900 font-bold mt-2">ðŸ‘‘ Maha Yodha â€“ All Unlimited</span><br><span class="text-green-800 font-semibold">Congratulations, you are the chosen one!</span>`
              : "";
          } else {
            // Not registered! Show plain Google info, zero coins/rank
            noUserSection.classList.remove('hidden');
            document.getElementById('auth-section').classList.add('hidden');
            profileSection.classList.add('hidden');
            document.getElementById('google-name').textContent = user.displayName || "";
            document.getElementById('google-email').textContent = user.email;
            document.getElementById('google-photo').src = user.photoURL || "";
          }
        });
    } catch (err) {
      loadingMsg.textContent = "";
      alert("Google sign-in failed: " + (err.message || "unknown error"));
    }
  };
</script>
</body>
  </html>
  
